---
title: "How we Classify Families"
output: html_document
---

## Introduction

This document outlines the methodology and logic used to produce family relationships and categorize households in our analysis. We will explain the criteria and processes applied to classify different household types and head of household status.

## Classification

The IPUMS dataset provides detailed information on relationships between individuals in a household through the `RELATE` and `RELATED` variables. The person filling out the survey is designated as "head of household" or "person 1" (this term has evolved to be more gender-inclusive). This individual receives the code `101` in the `RELATED` variable, and all other individuals in the same household are assigned codes based on their relationship to person 1. Below is a summary of these relationship statuses in the 2022 1-year American Community Survey, sorted by frequency. The `count` column shows the raw number of respondents with that code, and the `sum_weights` column represents the total number of people estimated to have that status in the U.S.

IPUMS provides detailed information on the relationships between individuals in a household through its `RELATED` variable. The person who answers the survey is designated as "head of household" or "person 1". ("Head of household" has fallen out of use by the Census, as it used to specifically designate men. The new terminology is intended to be more gender inclusive. In this document, we use them interchangeably.) This person receives the code of `101` in the `RELATED` variable. All other individuals in the same household unit are then assigned codes based on their relationship with this person. The following table is a summary of these statuses as they appeared in the 2022 1-year American Community Survey, sorted from most frequently reported to least frequently reported. The `count` column represents the raw number of respondents with that code. The `sum_weights` column represents the total number of people in the United States estimated to have that status by weighting the respondents using their `PERWT` values.

```{r related_vars_2022, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
hoh_status_2022 <- read.csv("../results/hoh_status_2022.csv")
kable(hoh_status_2022, caption = "2022 RELATED Values")
```

To validate the data, we can sum the `sum_weights` column, which should equal the total U.S. population in 2022. This sum is `r sum(hoh_status_2022$sum_weights)`, matching the reported population of 333.3 million in this year.

The following table expands upon "2022 RELATED Values" by showing unique answers from all year 2012 to 2022. This table has additional entry not present in the 2022 dataset, and will be used as a reference for variable encoding in later sections of this document.

```{r related_vars_overall, echo=FALSE}
hoh_status <- read.csv("../results/hoh_status.csv")
kable(hoh_status, caption = "RELATED Values, as reported from 2012-2022")
```

Accurately identifying individuals living with their parents presents some challenges. In this analysis, we focus on parents only (though future work may include parents-in-law). When a person is designated as "person 1" or "head of household" (`RELATED = 101`), identifying parents is relatively straightforward: we look for individuals in the household with `RELATED` codes of `501` ("parent"). For example consider the hypothetical household in table 1:

```{r tab01a, echo=FALSE}
hypothetical_data <- data.frame(
  pers_id = 1:5,
  hh_id = rep(1, 5),
  RELATED = c(101, 501, 501, 301, 301),
  RELATED_name = c("Head of Household", "Parent", "Parent", "Child", "Child"),
  AGE = c(26, 51, 52, 0, 2),
  SEX = c("F", "F", "M", "M", "M")
)
kable(hypothetical_data, caption = "Table 1a: Hypothetical Multigenerational Household")
```

In this household, a single mother lives with her two parents and her two children. In our `cohabit_parent` column, we assign values as follows:

```{r tab01b, echo=FALSE}
hypothetical_data$cohabit_parent <- c(2, 0, 0, 1, 1)
kable(hypothetical_data, caption = "Table 1b: Hypothetical Multigenerational Household")
```

Note that this variable is designed to represent the number of parents an individual lives with, which is why the variable is encoded as `2` for our single mother and `1` for her two children. If we later prefer to splice the data as a binary indicator variable, it is simple enough to encode all positive numbers as a `1` (`True`) value and all zeroes as a `0` (`False`) value.

### Complicating Cases

American families are not always so straightforward.For example, consider this household:

```{r tab02a, echo=FALSE}
hypothetical_data <- data.frame(
  pers_id = 1:3,
  hh_id = rep(2, 3),
  RELATED = c(101, 1114, 301),
  RELATED_name = c("Head of Household", "Unmarried Partner", "Child"),
  AGE = c(60, 62, 20),
  SEX = c("F", "M", "M"),
  cohabit_parent = c("0", "0", "1 or 2?"),
  cohabit_parent_binary = c("False", "False", "True")
)
kable(hypothetical_data, caption = "Table 2a: Unmarried Spouse and Adult Child")
```

In this example, we're able to classify the 20-year old young adult as living with at least one parent - in this case, the head of household. Should we also count the unmarried partner as an additional parent? This question is highly contextual and unlikely to be answerable given our limited information. It is also highly cultural.

We may breathe a sigh of relief that regardless of the answer, at least our `cohabit_parent_binary` column is unchanged: it still equals `True`, whether or not we classify the unmarried spouse of the child's mother as an additional parent. But our ability to discern this parenthood could be easily complicated if the same household had answered the survey differently:

```{r tab02b, echo=FALSE}
hypothetical_data <- data.frame(
  pers_id = 1:3,
  hh_id = rep(2, 3),
  RELATED = c("101", "1114", "303? 1001? or 1260?"),
  RELATED_name = c("Head of Household", "Unmarried Partner", "Stepchild? Other Relative? or Other Non-Relative?"),
  AGE = c(62, 60, 20),
  SEX = c("M", "F", "M"),
  cohabit_parent = c("0", "0", "0, 1, or 2?"),
  cohabit_parent_binary = c("False", "False", "False or True?")
)
kable(hypothetical_data, caption = "Table 2b: Unmarried Spouse and Adult Child")
```

The only difference between tables 2a and 2b are the person who filled out the survey. Because all relationships are classified through the head of household, our visibility into the relationship between two other housemates can be complicated by their relationship with the head of household. In this example, it's likely that the 62-year-old head of household might list the 20-year-old son of his spouse as his stepchild. But since him and his spouse are not technically married, he also might list this son as an "Other Relative" or "Other Non-Relative". In this case, we may accidentally fail to code the son as living with a parent.

These nuances cannot be eliminated. However, we can later run sensitivity analyses to various bucketing schemes to calculate the scope of our potential error. 

In the following section, we define our current parental cohabitation strategy.

## Classifying families: the current methodology

